\hypertarget{SystemManager_8hpp_source}{}\doxysection{System\+Manager.\+hpp}
\label{SystemManager_8hpp_source}\index{Source/Core/SystemManager.hpp@{Source/Core/SystemManager.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include "{}System.hpp"{}}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}Types.hpp"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <cassert>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <unordered\_map>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{keyword}{class }\mbox{\hyperlink{classSystemManager}{SystemManager}}}
\DoxyCodeLine{11 \{}
\DoxyCodeLine{12 \textcolor{keyword}{public}:}
\DoxyCodeLine{13     \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{14     std::shared\_ptr<T> RegisterSystem()}
\DoxyCodeLine{15     \{}
\DoxyCodeLine{16         \textcolor{keyword}{const} \textcolor{keywordtype}{char}* typeName = \textcolor{keyword}{typeid}(T).name();}
\DoxyCodeLine{17 }
\DoxyCodeLine{18         assert(mSystems.find(typeName) == mSystems.end() \&\& \textcolor{stringliteral}{"{}Registering system more than once."{}});}
\DoxyCodeLine{19 }
\DoxyCodeLine{20         \textcolor{keyword}{auto} system = std::make\_shared<T>();}
\DoxyCodeLine{21         mSystems.insert(\{typeName, system\});}
\DoxyCodeLine{22         \textcolor{keywordflow}{return} system;}
\DoxyCodeLine{23     \}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25     \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{26     \textcolor{keywordtype}{void} SetSignature(Signature signature)}
\DoxyCodeLine{27     \{}
\DoxyCodeLine{28         \textcolor{keyword}{const} \textcolor{keywordtype}{char}* typeName = \textcolor{keyword}{typeid}(T).name();}
\DoxyCodeLine{29 }
\DoxyCodeLine{30         assert(mSystems.find(typeName) != mSystems.end() \&\& \textcolor{stringliteral}{"{}System used before registered."{}});}
\DoxyCodeLine{31 }
\DoxyCodeLine{32         mSignatures.insert(\{typeName, signature\});}
\DoxyCodeLine{33     \}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35     \textcolor{keywordtype}{void} EntityDestroyed(Entity entity)}
\DoxyCodeLine{36     \{}
\DoxyCodeLine{37         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \textcolor{keyword}{const}\& pair : mSystems)}
\DoxyCodeLine{38         \{}
\DoxyCodeLine{39             \textcolor{keyword}{auto} \textcolor{keyword}{const}\& system = pair.second;}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 }
\DoxyCodeLine{42             system-\/>mEntities.erase(entity);}
\DoxyCodeLine{43         \}}
\DoxyCodeLine{44     \}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     \textcolor{keywordtype}{void} EntitySignatureChanged(Entity entity, Signature entitySignature)}
\DoxyCodeLine{47     \{}
\DoxyCodeLine{48         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \textcolor{keyword}{const}\& pair : mSystems)}
\DoxyCodeLine{49         \{}
\DoxyCodeLine{50             \textcolor{keyword}{auto} \textcolor{keyword}{const}\& type = pair.first;}
\DoxyCodeLine{51             \textcolor{keyword}{auto} \textcolor{keyword}{const}\& system = pair.second;}
\DoxyCodeLine{52             \textcolor{keyword}{auto} \textcolor{keyword}{const}\& systemSignature = mSignatures[type];}
\DoxyCodeLine{53 }
\DoxyCodeLine{54             \textcolor{keywordflow}{if} ((entitySignature \& systemSignature) == systemSignature)}
\DoxyCodeLine{55             \{}
\DoxyCodeLine{56                 system-\/>mEntities.insert(entity);}
\DoxyCodeLine{57             \}}
\DoxyCodeLine{58             \textcolor{keywordflow}{else}}
\DoxyCodeLine{59             \{}
\DoxyCodeLine{60                 system-\/>mEntities.erase(entity);}
\DoxyCodeLine{61             \}}
\DoxyCodeLine{62         \}}
\DoxyCodeLine{63     \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{keyword}{private}:}
\DoxyCodeLine{66     std::unordered\_map<const char*, Signature> mSignatures\{\};}
\DoxyCodeLine{67     std::unordered\_map<const char*, std::shared\_ptr<System>> mSystems\{\};}
\DoxyCodeLine{68 \};}

\end{DoxyCode}
